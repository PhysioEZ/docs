<div class="breadcrumbs">
    <a href="/" class="nav-link">Docs</a>
    <span>/</span>
    <span>Common Utilities</span>
    <span>/</span>
    <span>Database Handler</span>
</div>

<section id="db-introduction">
    <h1>Database Handler (`db.php`)</h1>
    <p>
        The <code>common/db.php</code> script is responsible for establishing and configuring the connection to the application's database. It creates a single, reusable PDO (PHP Data Objects) connection instance that is used by all other parts of the system for database interactions.
    </p>
</section>

<section id="how-it-works">
    <h2 id="how-it-works-heading">How It Works</h2>
    <p>
        When included, this script reads the database credentials (host, user, password, database name) from <code>common/db.php</code> and uses them to instantiate a new PDO object.
    </p>
    <p>
        Crucially, it configures the PDO connection with the following essential settings for robust development:
    </p>
    <ul>
        <li><strong>Error Mode:</strong> Sets the error mode to <code>PDO::ERRMODE_EXCEPTION</code>. This means that if a database query fails, a <code>PDOException</code> will be thrown, which can be caught in a <code>try...catch</code> block. This prevents silent failures and makes debugging easier.</li>
        <li><strong>Default Fetch Mode:</strong> Sets the default fetch mode to <code>PDO::FETCH_ASSOC</code>, so results are returned as associative arrays (column name => value) by default.</li>
        <li><strong>Emulated Prepares:</strong> This is turned off (<code>false</code>) to ensure that native prepared statements are used by the database driver, providing better security against SQL injection.</li>
    </ul>
</section>

<section id="usage-example">
    <h2 id="usage-example-heading">Usage and Example</h2>
    <p>
        To use the database connection in any script, simply include <code>common/db.php</code>. This will make the <code>$pdo</code> variable available in the script's scope.
    </p>
    <p>
        Always use prepared statements to safely pass data to your queries and wrap your database logic in a <code>try...catch</code> block.
    </p>
    <h3>Example: Fetching a Patient Record</h3>
    <pre><code>&lt;?php
require_once '../../common/auth.php'; // Protect the page
require_once '../../common/db.php';   // Provides the $pdo object

$patientId = 123; // Example ID from a GET request

try {
    // 1. Prepare the SQL statement
    $stmt = $pdo->prepare("SELECT full_name, email FROM patient_master WHERE id = ?");

    // 2. Execute with the parameter
    $stmt->execute([$patientId]);

    // 3. Fetch the result
    $patient = $stmt->fetch();

    if ($patient) {
        echo "Patient Name: " . htmlspecialchars($patient['full_name']);
    } else {
        echo "Patient not found.";
    }

} catch (PDOException $e) {
    // In a real application, log this error instead of displaying it
    error_log("Database error: " . $e->getMessage());
    http_response_code(500);
    echo "A server error occurred. Please try again later.";
}
?&gt;</code></pre>
</section>