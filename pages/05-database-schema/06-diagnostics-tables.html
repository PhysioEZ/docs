<div class="breadcrumbs">
    <a href="pages/introduction.html" class="nav-link">Docs</a>
    <span>/</span>
    <a href="pages/database/01-overview-and-er-diagram.html" class="nav-link">Database Schema</a>
    <span>/</span>
    <span>Diagnostics & Testing</span>
</div>

<section id="diagnostics-intro">
    <h1>Diagnostics & Testing Tables</h1>
    <p>
        This module manages the entire workflow for patient diagnostics, separate from regular treatments. It's
        designed to handle test inquiries, formal test orders, and the specific items or sub-tests included in that
        order.
    </p>
</section>

<hr class="section-divider">

<section id="diagram-diagnostics">
    <h2 id="diagram-diagnostics-heading">Use Case: Patient Testing Workflow</h2>
    <p>
        This diagram shows how a <code>test_inquiry</code> is converted into a formal <code>tests</code> order.
        This "order" then acts as a parent container for multiple <code>test_items</code>, which are the
        billable, individual tests selected from the main <code>tests_lists</code> catalog.
    </p>

    <div class="image-placeholder">
        <img src="pages/05-database-schema/assets/diagnostics-tables.png"
            alt="Diagnostics and Testing Tables ER Diagram">
        <p class="caption-text">Data flow for the patient testing module.</p>
    </div>

    <h3 id="data-flow-heading">Data Flow Explained</h3>
    <ol>
        <li>
            A potential test starts as a <code>test_inquiry</code>, linked to a <code>branches</code> and the
            <code>employees</code> member who logged it.
        </li>
        <li>
            When the patient agrees, this is converted into a <code>tests</code> record. This is the main "order"
            table, linking the <code>test_inquiry</code>, the <code>patient_id</code> (if they are registered),
            and the employee. It holds the overall payment status for the entire order.
        </li>
        <li>
            Inside this "order," one or more <code>test_items</code> are added. These are the specific, individual
            tests (e.g., "EMG - Right Arm"). Each item has its own status (e.g., 'Pending', 'Completed').
        </li>
        <li>
            The <code>tests_lists</code> table acts as a price catalog, defining the <code>test_name</code> and
            <code>default_amount</code> for all tests offered at a branch.
        </li>
    </ol>

    <h3 id="dbml-heading">DBML Code</h3>
    <p>
        This DBML code generates the diagram above.
    </p>
    <pre><code class="language-dbml">
// --- USE CASE 6: DIAGNOSTICS & TESTING MODULE ---

Table test_inquiry {
  inquiry_id int [PK]
  branch_id int [ref: > branches.branch_id]
  created_by_employee_id int [ref: > employees.employee_id]
  name varchar
  testname varchar
  mobile_number varchar
  status enum
}

Table tests {
  test_id int [PK]
  test_uid varchar
  branch_id int [ref: > branches.branch_id]
  patient_id int [ref: > patients.patient_id]
  inquiry_id int [ref: > test_inquiry.inquiry_id]
  created_by_employee_id int [ref: > employees.employee_id]
  patient_name varchar
  total_amount decimal
  payment_status enum
  test_status enum
}

Table test_items {
  item_id int [PK]
  test_id int [ref: > tests.test_id] // Links to the parent order
  created_by_employee_id int [ref: > employees.employee_id]
  test_name enum
  total_amount decimal
  test_status enum
}

Table tests_lists {
  test_id int [PK]
  branch_id int [ref: > branches.branch_id]
  test_name varchar
  default_amount decimal
}

Table patients {
  patient_id int [PK]
  master_patient_id bigint
  full_name varchar
}

Table employees {
  employee_id int [PK]
  first_name varchar
  last_name varchar
}

Table branches {
  branch_id int [PK]
  branch_name varchar
}
</code></pre>
</section>

<hr class="section-divider">

<section id="table-definitions-diagnostics">
    <h2 id="table-definitions-diagnostics-heading">Key Table Definitions</h2>

    <h3 id="tests-lists-table">tests_lists</h3>
    <p>
        This is the "master catalog" of all diagnostic tests the clinic offers. It defines the name and default price
        for each test, specific to a <code>branch_id</code>.
    </p>

    <h3 id="test-inquiry-table">test_inquiry</h3>
    <p>
        A lightweight "lead-capture" table, similar to <code>quick_inquiry</code>, but specifically for the
        diagnostics department.
    </p>

    <h3 id="tests-table">tests</h3>
    <p>
        This is the **"Order"** or **"Visit"** table. It represents a single testing session for a patient and tracks
        the *overall* payment status (<code>total_amount</code>, <code>payment_status</code>) for that entire session.
    </p>

    <h3 id="test-items-table">test_items</h3>
    <p>
        This is the **"Order Item"** table. Each record is a *specific test* that was part of a "Visit"
        (linked by <code>test_id</code>). This table allows multiple tests to be added to a single patient order,
        each with its own <code>test_status</code> (e.g., 'Pending', 'Awaiting Report', 'Completed').
    </p>
</section>