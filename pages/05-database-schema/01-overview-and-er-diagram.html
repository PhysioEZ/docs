<div class="breadcrumbs">
    <a href="pages/introduction.html" class="nav-link">Docs</a>
    <span>/</span>
    <span>Database Schema</span>
    <span>/</span>
    <span>Overview</span>
</div>
<br>
<section id="db-overview">
    <h1>Database Schema Overview</h1>
    <p>
        The CareSyncOS database is the backbone of the application, built to be secure, scalable, and auditable.
        The schema is structured around a few core concepts: **Branches**, **Employees**, **Patients**, and the
        **interactions**
        that link them together.
    </p>
    <p>
        A single, monolithic ER diagram for a system this complex is unreadable. Instead, we document the schema
        through a series of **Use-Case Diagrams**. Each one isolates a specific business process (like onboarding,
        treatment, or financials) so you can understand the data flow for that feature.
    </p>
</section>

<hr class="section-divider">

<section id="diagram-onboarding">
    <h2 id="diagram-onboarding-heading">1. Use Case: Patient Onboarding</h2>
    <p>
        This first diagram illustrates the "new patient" funnel. It shows the data flow from a person's first point
        of contact (an inquiry) to their full, formal registration as a patient in the system.
    </p>

    <div class="image-placeholder">
        <img src="pages/05-database-schema/assets/patient-onboarding.png" alt="Patient Onboarding ER Diagram">
        <p class="caption-text">Data flow for new patient registration</p>
    </div>

    <h3 id="data-flow-heading">Data Flow Explained</h3>
    <ol>
        <li>
            <strong>Initial Contact:</strong> A person first enters the system as a lightweight record in either
            <code>quick_inquiry</code> or <code>appointment_requests</code>. This captures basic contact info and links
            them to a specific <code>branches</code>.
        </li>
        <li>
            <strong>Formal Registration:</strong> An <code>employees</code> member converts the inquiry by creating a
            full <code>registration</code> record. This new record links back to the original
            <code>quick_inquiry</code> and captures detailed demographics, medical info, and consultation fees.
        </li>
        <li>
            <strong>Master Record Creation:</strong> This registration triggers the creation of a **global** record in
            <code>patient_master</code>. This table ensures a patient has one unique ID across the *entire*
            organization,
            even if they visit multiple branches.
        </li>
        <li>
            <strong>Branch Record Creation:</strong> Finally, a <code>patients</code> record is created. This is the
            patient's **local** file for that specific <code>branches</code>, linking to their
            <code>patient_master</code>
            ID. This record will hold their treatment plans, appointments, and payments for that branch.
        </li>
    </ol>

    <h3 id="dbml-heading">DBML Code</h3>
    <p>
        You can paste this code into <a href="https://dbdiagram.io/" target="_blank"
            rel="noopener noreferrer">dbdiagram.io</a>
        to see and interact with the live ER diagram.
    </p>
    <pre><code class="language-dbml">
// --- USE CASE 1: PATIENT ONBOARDING & REGISTRATION ---

Table branches {
  branch_id int [PK]
  branch_name varchar
  is_active tinyint
}

Table employees {
  employee_id int [PK]
  user_id int
  branch_id int [ref: > branches.branch_id]
  role_id int
  first_name varchar
  last_name varchar
}

Table quick_inquiry {
  inquiry_id int [PK]
  branch_id int [ref: > branches.branch_id]
  created_by_employee_id int [ref: > employees.employee_id]
  name varchar
  phone_number varchar
  status enum
  created_at timestamp
}

Table appointment_requests {
  id int [PK]
  fullName varchar
  phone varchar
  branch_id int [ref: > branches.branch_id]
  created_at datetime
  status enum
}

Table registration {
  registration_id int [PK]
  master_patient_id bigint [ref: > patient_master.master_patient_id]
  branch_id int [ref: > branches.branch_id]
  inquiry_id int [ref: > quick_inquiry.inquiry_id]
  created_by_employee_id int [ref: > employees.employee_id]
  patient_name varchar
  phone_number varchar
  status enum
  created_at timestamp
}

Table patient_master {
  master_patient_id bigint [PK]
  patient_uid varchar
  full_name varchar
  phone_number varchar
  first_registered_at timestamp
  first_registered_branch_id int [ref: > branches.branch_id]
}

Table patients {
  patient_id int [PK]
  master_patient_id bigint [ref: > patient_master.master_patient_id]
  branch_id int [ref: > branches.branch_id]
  registration_id int [ref: > registration.registration_id]
  created_by_employee_id int [ref: > employees.employee_id]
  status enum
  created_at timestamp
}

</code></pre>
</section>