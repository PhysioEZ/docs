<div class="breadcrumbs">
    <a href="/" class="nav-link">Docs</a>
    <span>/</span>
    <span>Architecture</span>
    <span>/</span>
    <span>Request Flow</span>
</div>

<section id="flow-introduction">
    <h1>Application Request Flow</h1>
    <p>
        Understanding the request flow is key to seeing how CareSyncOS handles security and routes users to the correct module. This document outlines the journey a user takes from their first visit to landing on their role-specific dashboard.
    </p>
</section>

<section id="authentication-journey">
    <h2 id="authentication-journey-heading">The Authentication Journey</h2>
    <p>The entire authentication process is a well-defined sequence designed to validate credentials and establish a secure session before granting access to any internal module.</p>
    <ol>
        <li>
            <strong>Initial Entry:</strong> The user first accesses the system at <code>/OS/</code>, which loads the main landing page. This page directs them to <code>login.php</code>.
        </li>
        <li>
            <strong>Credential Submission:</strong> The user submits their credentials through the login form. This form posts the data to a process that invokes <code>common/auth.php</code> for validation.
        </li>
        <li>
            <strong>Session Creation:</strong> If the credentials are valid, <code>common/auth.php</code> performs several critical actions:
            <ul>
                <li>A new, secure session is created for the user.</li>
                <li>The user's role, ID, IP address, and User-Agent are stored in the session to prevent hijacking.</li>
                <li>System-wide encryption keys may be loaded into the session if needed.</li>
            </ul>
        </li>
        <li>
            <strong>Redirection to Module:</strong> Once the session is established, the user is redirected to the entry point of their assigned role module (e.g., <code>/OS/admin/</code> or <code>/OS/doctor/</code>).
        </li>
    </ol>
</section>

<section id="protecting-pages">
    <h2 id="protecting-pages-heading">Protecting Module Pages</h2>
    <p>
        The most critical security rule in the architecture is that <strong>every restricted PHP file</strong> within a module must begin by including the authentication script.
    </p>
    <pre><code>&lt;?php
// At the very top of /admin/views/dashboard.php
require_once '../../common/auth.php';

// The rest of the page logic follows...
?&gt;</code></pre>
    <p>
        This single line of code acts as a gatekeeper. If a valid session does not exist or if the session details (IP, User-Agent) don't match, <code>auth.php</code> will immediately halt execution and redirect the user back to the login page. This prevents any unauthorized access to internal pages.
    </p>
</section>

<section id="visual-flow">
    <h2 id="visual-flow-heading">Visual Flow Diagram</h2>
    <p>The diagram below illustrates the standard user flow from login to accessing a protected page.</p>
    <pre><code>User Browser          -&gt; /OS/login.php
      |
      | (POST Credentials)
      v
`common/auth.php`   (Validates user, creates session)
      |
      | (Redirect)
      v
`/<role>/views/page.php` (Includes `auth.php` to verify session)
      |
      | (Session is valid)
      v
Page content is rendered and sent to the user.</code></pre>
</section>