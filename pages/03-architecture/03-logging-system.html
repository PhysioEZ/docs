<div class="breadcrumbs">
    <a href="/" class="nav-link">Docs</a>
    <span>/</span>
    <span>Architecture</span>
    <span>/</span>
    <span>Logging System</span>
</div>

<section id="logging-introduction">
    <h1>Logging System</h1>
    <p>
        The logging system provides an immutable, audit-grade trail of all significant actions performed within CareSyncOS. Every important event, from a user logging in to a patient record being updated, is recorded in the database. This ensures accountability, aids in debugging, and provides a clear history of data modifications.
    </p>
    <p>
        All logging functionality is handled by the centralized logger located at <code>common/logger.php</code>.
    </p>
</section>

<section id="log-structure">
    <h2 id="log-structure-heading">Log Structure</h2>
    <p>Each log entry is stored as a record in the database and contains a consistent set of data points to provide maximum context for the event:</p>
    <ul>
        <li><strong>employee_id:</strong> The ID of the employee who performed the action.</li>
        <li><strong>affected_module:</strong> The name of the module where the event occurred (e.g., 'admin', 'doctor').</li>
        <li><strong>action_type:</strong> The type of action performed (e.g., 'LOGIN_SUCCESS', 'CREATE', 'UPDATE', 'DELETE').</li>
        <li><strong>target_table:</strong> The primary database table that was affected by the action.</li>
        <li><strong>payload:</strong> A full JSON object containing detailed, context-specific information about the event.</li>
        <li><strong>ip_address:</strong> The IP address of the user who triggered the event.</li>
        <li><strong>user_agent:</strong> The browser or device information of the user.</li>
        <li><strong>timestamp:</strong> The exact date and time the event occurred.</li>
    </ul>
</section>

<section id="how-to-log">
    <h2 id="how-to-log-heading">How to Log an Event</h2>
    <p>
        To log an event, you must include <code>common/logger.php</code> and call the <code>log_event()</code> function. You should pass all the relevant details about the action that just occurred.
    </p>
    <p>
        The most important part is constructing a meaningful JSON payload. This payload should contain enough information to understand exactly what happened without needing to cross-reference other data.
    </p>
    
    <h3>Example: Logging a Patient Update</h3>
    <p>
        In this example, a doctor updates a patient's treatment plan. After the database update is successful, we log the event.
    </p>
    <pre><code>&lt;?php
require_once '../../common/auth.php'; // Ensures user is authenticated
require_once '../../common/logger.php'; // Provides the log_event() function

// Assume $pdo is available and a patient update has just occurred.
$patientId = 45;
$updatedPlan = "New physical therapy regimen.";

// --- Log the successful update ---
log_event(
    $_SESSION['employee_id'],
    'doctor',
    'UPDATE',
    'patients',
    json_encode([
        'patient_id' => $patientId,
        'field_updated' => 'treatment_plan',
        'new_value' => $updatedPlan,
        'message' => "Dr. {$_SESSION['full_name']} updated the treatment plan."
    ])
);
?&gt;</code></pre>
</section>

<section id="what-to-log">
    <h2 id="what-to-log-heading">What to Log</h2>
    <p>As a rule, every action that creates, modifies, deletes, or accesses sensitive data must be logged. Key events include:</p>
    <ul>
        <li>User authentication (successful logins, failed attempts).</li>
        <li>Creation, modification, or deletion of any core data (patients, appointments, expenses, employees).</li>
        <li>Viewing of sensitive patient records.</li>
        <li>Changes in system configuration or user roles.</li>
        <li>File uploads and deletions.</li>
    </ul>
</section>